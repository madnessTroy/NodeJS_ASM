<!-- HEAD -->
<%- include('../includes/head.ejs')%>
    <body>
        <!-- navbar -->
        <%- include('../includes/navbar.ejs', {staff: admin[0]}) %>
        <hr>
        <div class="container-fluid">
            <div class="card mb-5 form-control bg-dark">
                <div class="row">
                    <div class="card-body text-light">
                        <div class="col-12">
                            <form method="POST">
                                <select name="monthSelect" id="monthSelect" class="fs-4">
                                    <option value="1">Tháng 1</option>
                                    <option value="2">Tháng 2</option>
                                    <option value="3">Tháng 3</option>
                                    <option value="4">Tháng 4</option>
                                    <option value="5">Tháng 5</option>
                                    <option value="6">Tháng 6</option>
                                    <option value="7">Tháng 7</option>
                                    <option value="8">Tháng 8</option>
                                    <option value="9">Tháng 9</option>
                                    <option value="10">Tháng 10</option>
                                    <option value="11">Tháng 11</option>
                                    <option value="12">Tháng 12</option>
                                </select>
                                <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                                <button type="submit" class="btn btn-danger fs-6 mb-2">Chọn</button>
                                <h1 class="float-end">Nhân viên: <%= staff[0].userId.name %></h1>
                            </form>
                        </div>
                            <% if (staff !== undefined) { %>
                                <!-- Lương tháng -->
                                <hr>
                                <div class="text-center">
                                    <h1 class="text-dark bg-warning py-3">TỔNG HỢP</h1>
                                    <div class="row">
                                        <div class="col-4">
                                            <h3>Hệ số lương: <%= staff[0].userId.salaryScale %></h3>
                                            <h3>Tổng giờ còn thiếu: <%= totalSortTime %></h3>
                                            <h3>Tổng giờ tăng ca: <%= totalOverTime %> </h3>
                                        </div>
                                        <div class="col-8">
                                            <h2>LƯƠNG THÁNG <%= staff[0].month %></h2>
                                            <h2 class="text-warning"><%= salary %></h2>
                                            <p>Hệ số lương x 3000000 + (Tổng giờ tăng ca - Tổng giờ còn thiếu) x 200000</p>
                                        </div>
                                    </div>
                                </div>
                                <hr>

                                <!-- Chi tiết theo ngày -->
                                <h1 class="text-dark text-center bg-warning py-3">CHI TIẾT TỪNG NGÀY</h1>
                                <div class="row">
                                    <% staff.forEach((item) => { %>
                                        <h3 class="text-warning">
                                            NGÀY: <%= item.date %>-<%= item.month %>
                                        </h3>
                                        <div class="col-6">
                                            <table class="table table-warning table-striped align-middle">
                                                <thead>
                                                    <tr>
                                                        <th scope="col" class="col-3">Nơi Làm</th>
                                                        <th scope="col" class="col-3">Bắt Đầu</th>
                                                        <th scope="col" class="col-3">Kết Thúc</th>
                                                        <th scope="col" class="col-3">Đã Làm</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <% item.timesheet.forEach((data) => { %>
                                                        <tr>
                                                            <td class="col-3"><%= data.place %></td>
                                                            <td class="col-3"><%= data.start.toLocaleTimeString() %></td>
                                                            <td class="col-3"><%= data.end ? data.end.toLocaleTimeString() : '-'  %></td>
                                                            <td class="col-3">
                                                            <% if(item.isEdit === true) { %>
                                                                <form method="POST" action="/admin/deleteWorked/<%= staff[0].userId._id %>">
                                                                    <%= data.worked ? data.worked : 0 %>
                                                                    <input type="hidden" name="start" value="<%= data.start %>">
                                                                    <input type="hidden" name="checkId" value="<%= data._id %>">

                                                                    <input type="hidden" name="_csrf" value="<%= csrfToken %>">

                                                                    <button class="btn btn-danger fs-6 float-end delete-btn" type="button" title="Xoá">
                                                                        Xoá
                                                                    </button>
                                                                    <!-- Submit/ Cancel -->
                                                                    <button class="btn btn-danger fs-6 float-end confirm-btn" type="submit">
                                                                        Xác Nhận
                                                                    </button>
                                                                    <button class="btn btn-secondary fs-6 float-end cancel-btn" type="button">
                                                                        Huỷ
                                                                    </button>
                                                                </form>
                                                            <% } else { %>
                                                                <%= data.worked ? data.worked : 0 %>
                                                            <% } %>
                                                            </td>
                                                        </tr>
                                                    <% }) %>
                                                </tbody>
                                            </table>
                                        </div>
                                        <div class="col-6">
                                            <table class="table table-bordered table-danger border-dark text-center">
                                                <thead>
                                                    <tr>
                                                        <th>Tổng (Đã làm)</th>
                                                        <th>Tăng Ca</th>
                                                        <th>Nghỉ phép</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td><%= item.totalHrs %> giờ</td>
                                                        <td><%= item.overTime %> giờ</td>
                                                        <td><%= item.annualLeaveTime %></td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    <% }) %>
                                </div>
                            <% } else { %>
                                <% if(monthSelect === undefined) { %>
                                    <h1 class="text-center text-warning">  KHÔNG CÓ DỮ LIỆU!</h1>
                                <% } else { %>
                                    <h1 class="text-center text-warning">THÁNG <%= monthSelect %> HIỆN TẠI CHƯA CÓ DỮ LIỆU!</h1>
                                <% } %>
                            <% } %>
                            <hr>
                            <!-- Pagination -->
                            <%- include('../includes/pagination.ejs', {currentPage: currentPage, nextPage: nextPage, previousPage: previousPage, lastPage: lastPage, hasNextPage: hasNextPage, hasPreviousPage: hasPreviousPage}) %>
                        </div>
                </div>
            </div>
        </div>
    </body>

<!-- END -->
<%- include('../includes/end.ejs') %>

<script src="/js/admin-worked.js"></script>
</html>